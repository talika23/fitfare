{% comment %} 
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Nutrition Planner</title>
<link rel="stylesheet" href="{% static 'core/css/bootstrap.min.css' %}">
<style>
  :root {
    --primary: #ff7a7a;
    --accent: #3b82f6;
    --bg: linear-gradient(135deg, #fff0f0, #f7f9ff);
    --card-bg: #ffffff;
    --text: #0f172a;
    --muted: #6b7280;
  }

  body {
    font-family: "Poppins", sans-serif;
    background: var(--bg);
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
    padding: 10px;
  }

  /* 👇 Super compact box */
  .nutrition-box {
    background: var(--card-bg);
    width: 100%;
    max-width: 300px; /* Very small box */
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(16,24,40,0.15);
    padding: 10px 12px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .header {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .logo {
    background: linear-gradient(135deg, var(--primary), #ffb3b3);
    color: #fff;
    font-weight: 700;
    font-size: 12px;
    padding: 5px 8px;
    border-radius: 6px;
  }

  .header h3 {
    margin: 0;
    font-size: 14px;
  }

  .header p {
    margin: 0;
    color: var(--muted);
    font-size: 10px;
  }

  .chat-log {
    flex: 1;
    min-height: 140px;
    border: 1px solid #eef2ff;
    background: #fafcff;
    border-radius: 6px;
    padding: 6px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .message {
    max-width: 85%;
    padding: 5px 8px;
    border-radius: 8px;
    line-height: 1.3;
    font-size: 12px;
    box-shadow: 0 2px 6px rgba(16,24,40,0.05);
  }

  .msg-user {
    background: linear-gradient(90deg, var(--accent), #60a5fa);
    color: #fff;
    align-self: flex-end;
    border-bottom-right-radius: 4px;
  }

  .msg-bot {
    background: #f1f5f9;
    color: var(--text);
    align-self: flex-start;
    border-bottom-left-radius: 4px;
  }

  .meta {
    font-size: 8px;
    color: var(--muted);
    margin-top: 2px;
  }

  .input-row {
    display: flex;
    gap: 4px;
  }

  .input-row input {
    flex: 1;
    padding: 6px;
    border-radius: 6px;
    border: 1px solid #e6eefc;
    font-size: 12px;
    outline: none;
  }

  .btn-primary {
    background: linear-gradient(90deg, var(--primary), #ff9a9a);
    border: none;
    color: #fff;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
  }

  .tools {
    border-top: 1px solid #f1f5f9;
    padding-top: 5px;
  }

  .tools h4 {
    font-size: 12px;
    margin-bottom: 4px;
  }

  .chip {
    padding: 4px 6px;
    background: #f8fafc;
    border-radius: 999px;
    border: 1px solid #eef2ff;
    font-size: 10px;
    cursor: pointer;
    margin: 2px;
  }

  .chip:hover { background: #eef2ff; }

  .small-input {
    width: 100%;
    padding: 4px 6px;
    border-radius: 6px;
    border: 1px solid #eef2ff;
    margin-top: 3px;
    font-size: 11px;
  }

  .actions {
    display: flex;
    gap: 3px;
    margin-top: 4px;
    flex-wrap: wrap;
  }

  .action-btn {
    border: none;
    border-radius: 6px;
    padding: 4px 6px;
    cursor: pointer;
    font-size: 10px;
  }

  .action-export { background: #e6fffa; color: #0f766e; }
  .action-clear { background: #fff1f2; color: #9f1239; border: 1px solid #fee2e2; }
</style>
</head>
<body>

<div class="nutrition-box">
  <div class="header">
    <div class="logo">NF</div>
    <div>
      <h3>AI Nutrition Planner</h3>
      <p>Compact chat & plan</p>
    </div>
  </div>

  <div id="chat-log" class="chat-log"></div>

  <div class="input-row">
    <input id="user-input" type="text" placeholder="Ask e.g. 'Calories for rice'">
    <button id="send-btn" class="btn-primary">Send</button>
  </div>

  <div class="tools">
    <h4>Quick Commands</h4>
    <div>
      <div class="chip" data-cmd="calories for banana">Calories for banana</div>
      <div class="chip" data-cmd="plan for weight loss">Plan weight loss</div>
      <div class="chip" data-cmd="water for 70 kg">Water 70kg</div>
      <div class="chip" data-cmd="motivate me">Motivate me</div>
      <div class="chip" data-cmd="bmi 170 cm 60 kg">BMI</div>
    </div>

    <select id="goal-select" class="small-input">
      <option value="maintain">Maintain</option>
      <option value="weight_loss">Weight loss</option>
      <option value="muscle_gain">Muscle gain</option>
    </select>
    <input id="user-weight" class="small-input" placeholder="Weight (kg)">
    <div class="actions">
      <button class="chip" id="create-plan">Plan</button>
      <button class="chip" id="calc-water">Water</button>
      <button id="clear-local" class="action-btn action-clear">Clear</button>
      <button id="export-json" class="action-btn action-export">Export</button>
    </div>
  </div>
</div>

<script>
const FOOD_DB = {
  "banana": { calories: 105, protein: "1.3g", carbs: "27g", fat: "0.4g", fiber: "3.1g" },
  "apple": { calories: 95, protein: "0.5g", carbs: "25g", fat: "0.3g", fiber: "4.4g" },
  "egg": { calories: 78, protein: "6.3g", carbs: "0.6g", fat: "5.3g", fiber: "0g" },
  "rice": { calories: 206, protein: "4.2g", carbs: "45g", fat: "0.4g", fiber: "0.6g" }
};

function renderMessage(text, sender="bot") {
  const log = document.getElementById("chat-log");
  const msg = document.createElement("div");
  msg.className = "message " + (sender==="user"?"msg-user":"msg-bot");
  msg.innerHTML = `<div>${text}</div><div class="meta">${sender==="user"?"You":"AI"} • ${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>`;
  log.appendChild(msg);
  log.scrollTop = log.scrollHeight;
  const history = JSON.parse(localStorage.getItem("chatHistory")||"[]");
  history.push({text, sender});
  localStorage.setItem("chatHistory", JSON.stringify(history));
}

function loadHistory() {
  const h = JSON.parse(localStorage.getItem("chatHistory")||"[]");
  h.forEach(m=>renderMessage(m.text,m.sender));
}

function clearHistory(){ localStorage.removeItem("chatHistory"); document.getElementById("chat-log").innerHTML=""; }

function handleUserInput(text){
  renderMessage(text,"user");
  text=text.toLowerCase();
  let res="";

  if(text.includes("calories")){
    const f = Object.keys(FOOD_DB).find(k=>text.includes(k));
    if(f){ const d=FOOD_DB[f]; res=`${f} → ${d.calories} kcal, Protein: ${d.protein}, Carbs: ${d.carbs}`; }
    else res="Food not found.";
  }
  else if(text.includes("plan for")){ res="Meal plan generated 🍽️ Stay hydrated!"; }
  else if(text.includes("water")){ res="Drink ~35 ml water per kg 💧."; }
  else if(text.includes("bmi")){ res="BMI = weight(kg)/(height(m))². Normal: 18.5–24.9 ✅"; }
  else if(text.includes("motivate")){ res="You're doing great 💪"; }
  else res="Try asking about calories, water, BMI, or plans.";

  setTimeout(()=>renderMessage(res,"bot"),300);
}

document.getElementById("send-btn").onclick = ()=>{ const val=document.getElementById("user-input").value.trim(); if(val){ handleUserInput(val); document.getElementById("user-input").value=""; } };
document.getElementById("user-input").addEventListener("keypress",e=>{ if(e.key==="Enter") document.getElementById("send-btn").click(); });
document.getElementById("clear-local").onclick=()=>{ if(confirm("Clear chat history?")) clearHistory(); };
document.getElementById("export-json").onclick=()=>{
  const data = localStorage.getItem("chatHistory")||"[]";
  const blob = new Blob([data],{type:"application/json"});
  const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="nutrition_chat.json"; a.click();
};
document.querySelectorAll(".chip[data-cmd]").forEach(c=>c.onclick=()=>{ document.getElementById("user-input").value=c.dataset.cmd; document.getElementById("send-btn").click(); });
document.getElementById("create-plan").onclick=()=>{ document.getElementById("user-input").value="plan for "+document.getElementById("goal-select").value; document.getElementById("send-btn").click(); };
document.getElementById("calc-water").onclick=()=>{ const w=document.getElementById("user-weight").value; document.getElementById("user-input").value="water for "+w+" kg"; document.getElementById("send-btn").click(); };
loadHistory();
</script>
</body>
</html>  {% endcomment %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Nutrition Planner 🥗</title>
<link rel="stylesheet" href="{% static 'core/css/bootstrap.min.css' %}">
<style>
:root {
  --primary: #ff7a7a;
  --accent: #3b82f6;
  --bg: linear-gradient(135deg, #fff0f0, #f0f8ff);
  --card-bg: #ffffffee;
  --text: #0f172a;
  --muted: #6b7280;
  --hover: #f3f4f6;
}

body {
  font-family: "Poppins", sans-serif;
  background: var(--bg);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
  padding: 10px;
  overflow: hidden;
}

.nutrition-box {
  width: 100%;
  max-width: 360px;
  background: var(--card-bg);
  border-radius: 20px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.25);
  padding: 16px;
  display: flex;
  flex-direction: column;
  animation: fadeIn 1s ease;
  transition: transform 0.3s;
}

.nutrition-box:hover { transform: translateY(-3px); }

@keyframes fadeIn { from {opacity:0; transform: translateY(20px);} to {opacity:1; transform: translateY(0);} }

.header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.logo {
  background: linear-gradient(135deg, var(--primary), #ffb3b3);
  color: #fff;
  font-weight: 700;
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 8px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.header h3 { margin: 0; font-size: 16px; font-weight: 600; color: var(--text); }
.header p { margin: 0; font-size: 11px; color: var(--muted); }

.chat-log {
  flex: 1;
  min-height: 180px;
  border-radius: 12px;
  background: #f9fafc;
  padding: 10px;
  margin: 8px 0;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 6px;
  border: 1px solid #e0e7ff;
  scroll-behavior: smooth;
}

.message {
  max-width: 85%;
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 13px;
  line-height: 1.4;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  animation: msgFade 0.3s ease;
}

@keyframes msgFade { from {opacity:0; transform: scale(0.95);} to {opacity:1; transform: scale(1);} }

.msg-user { background: linear-gradient(90deg, var(--accent), #60a5fa); color: #fff; align-self: flex-end; border-bottom-right-radius: 4px; }
.msg-bot { background: #f1f5f9; color: var(--text); align-self: flex-start; border-bottom-left-radius: 4px; }

.meta { font-size: 9px; color: var(--muted); margin-top: 2px; }

.input-row { display: flex; gap: 6px; margin-top: 6px; }

.input-row input {
  flex: 1;
  padding: 8px 10px;
  border-radius: 12px;
  border: 1px solid #e0e7ff;
  font-size: 13px;
  outline: none;
  transition: 0.3s;
}

.input-row input:focus { border-color: var(--accent); box-shadow: 0 0 5px rgba(59,130,246,0.3); }

.btn-primary {
  background: linear-gradient(90deg, var(--primary), #ff9a9a);
  border: none;
  color: #fff;
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
}

.btn-primary:hover { transform: scale(1.05); }

.tools { border-top: 1px solid #e5e7ff; padding-top: 6px; margin-top: 6px; }
.tools h4 { font-size: 12px; margin-bottom: 4px; color: var(--text); }

.chip {
  display: inline-block;
  padding: 5px 8px;
  margin: 3px;
  font-size: 11px;
  border-radius: 999px;
  background: #f8fafc;
  border: 1px solid #e0e7ff;
  cursor: pointer;
  transition: 0.3s;
}
.chip:hover { background: var(--hover); }

.small-input { width: 100%; padding: 5px 8px; border-radius: 10px; border: 1px solid #e0e7ff; font-size: 12px; margin-top: 3px; }

.actions { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 4px; }
.action-btn { font-size: 11px; padding: 4px 6px; border-radius: 8px; cursor: pointer; border: none; }
.action-export { background: #d1fae5; color: #065f46; }
.action-clear { background: #fee2e2; color: #9f1239; border: 1px solid #fecaca; }

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 6px; }
</style>
</head>
<body>

<div class="nutrition-box">
  <div class="header">
    <div class="logo">NF</div>
    <div>
      <h3>AI Nutrition Planner</h3>
      <p>Smart & Interactive</p>
    </div>
  </div>

  <div id="chat-log" class="chat-log"></div>

  <div class="input-row">
    <input id="user-input" type="text" placeholder="Ask e.g., 'Calories for rice'">
    <button id="send-btn" class="btn-primary">Send</button>
  </div>

  <div class="tools">
    <h4>Quick Commands</h4>
    <div>
      <div class="chip" data-cmd="calories for banana">Calories for banana</div>
      <div class="chip" data-cmd="plan for weight loss">Plan weight loss</div>
      <div class="chip" data-cmd="water for 70 kg">Water 70kg</div>
      <div class="chip" data-cmd="motivate me">Motivate me</div>
      <div class="chip" data-cmd="bmi 170 cm 60 kg">BMI</div>
    </div>

    <select id="goal-select" class="small-input">
      <option value="maintain">Maintain</option>
      <option value="weight_loss">Weight loss</option>
      <option value="muscle_gain">Muscle gain</option>
    </select>
    <input id="user-weight" class="small-input" placeholder="Weight (kg)">

    <div class="actions">
      <button class="chip" id="create-plan">Plan</button>
      <button class="chip" id="calc-water">Water</button>
      <button id="clear-local" class="action-btn action-clear">Clear</button>
      <button id="export-json" class="action-btn action-export">Export</button>
    </div>
  </div>
</div>

<script>
// -------------------- Chat Logic --------------------
const FOOD_DB = {
   "banana": { calories: 105, protein: "1.3g", carbs: "27g", fat: "0.4g", fiber: "3.1g" },
  "apple": { calories: 95, protein: "0.5g", carbs: "25g", fat: "0.3g", fiber: "4.4g" },
  "orange": { calories: 62, protein: "1.2g", carbs: "15g", fat: "0.2g", fiber: "3.1g" },
  "grapes": { calories: 62, protein: "0.6g", carbs: "16g", fat: "0.3g", fiber: "0.8g" },
  "strawberry": { calories: 4, protein: "0.1g", carbs: "1g", fat: "0g", fiber: "0.2g" },
  "blueberry": { calories: 84, protein: "1.1g", carbs: "21g", fat: "0.5g", fiber: "3.6g" },
  "mango": { calories: 60, protein: "0.8g", carbs: "15g", fat: "0.3g", fiber: "1.6g" },
  "pineapple": { calories: 82, protein: "0.9g", carbs: "22g", fat: "0.2g", fiber: "2.3g" },
  "watermelon": { calories: 46, protein: "0.9g", carbs: "11.5g", fat: "0.2g", fiber: "0.4g" },
  "papaya": { calories: 43, protein: "0.5g", carbs: "11g", fat: "0.1g", fiber: "1.7g" },
  "kiwi": { calories: 42, protein: "0.8g", carbs: "10g", fat: "0.4g", fiber: "2.1g" },
  "pear": { calories: 101, protein: "0.6g", carbs: "27g", fat: "0.3g", fiber: "5.5g" },
  "cherry": { calories: 50, protein: "1g", carbs: "12g", fat: "0.3g", fiber: "1.6g" },
  "egg": { calories: 78, protein: "6.3g", carbs: "0.6g", fat: "5.3g", fiber: "0g" },
  "milk": { calories: 103, protein: "8g", carbs: "12g", fat: "2.4g", fiber: "0g" },
  "yogurt": { calories: 59, protein: "10g", carbs: "3.6g", fat: "0.4g", fiber: "0g" },
  "cheese": { calories: 113, protein: "7g", carbs: "1g", fat: "9g", fiber: "0g" },
  "chicken": { calories: 165, protein: "31g", carbs: "0g", fat: "3.6g", fiber: "0g" },
  "beef": { calories: 250, protein: "26g", carbs: "0g", fat: "15g", fiber: "0g" },
  "pork": { calories: 242, protein: "27g", carbs: "0g", fat: "14g", fiber: "0g" },
  "salmon": { calories: 208, protein: "20g", carbs: "0g", fat: "13g", fiber: "0g" },
  "tuna": { calories: 132, protein: "28g", carbs: "0g", fat: "1g", fiber: "0g" },
  "shrimp": { calories: 99, protein: "24g", carbs: "0.2g", fat: "0.3g", fiber: "0g" },
  "tofu": { calories: 76, protein: "8g", carbs: "1.9g", fat: "4.8g", fiber: "0.3g" },
  "lentils": { calories: 116, protein: "9g", carbs: "20g", fat: "0.4g", fiber: "8g" },
  "chickpeas": { calories: 164, protein: "9g", carbs: "27g", fat: "2.6g", fiber: "7.6g" },
  "black beans": { calories: 132, protein: "8.9g", carbs: "23.7g", fat: "0.5g", fiber: "8.7g" },
  "brown rice": { calories: 216, protein: "5g", carbs: "44g", fat: "1.8g", fiber: "3.5g" },
  "oats": { calories: 389, protein: "17g", carbs: "66g", fat: "7g", fiber: "11g" },
  "bread": { calories: 79, protein: "3g", carbs: "15g", fat: "1g", fiber: "1.9g" },
  "pasta": { calories: 131, protein: "5g", carbs: "25g", fat: "1.1g", fiber: "1.3g" },
  "potato": { calories: 77, protein: "2g", carbs: "17g", fat: "0.1g", fiber: "2.2g" },
  "sweet potato": { calories: 86, protein: "1.6g", carbs: "20g", fat: "0.1g", fiber: "3g" },
  "carrot": { calories: 41, protein: "0.9g", carbs: "10g", fat: "0.2g", fiber: "2.8g" },
  "spinach": { calories: 23, protein: "2.9g", carbs: "3.6g", fat: "0.4g", fiber: "2.2g" },
  "broccoli": { calories: 55, protein: "3.7g", carbs: "11g", fat: "0.6g", fiber: "5g" }
};

function renderMessage(text, sender="bot") {
  const log = document.getElementById("chat-log");
  const msg = document.createElement("div");
  msg.className = "message " + (sender==="user"?"msg-user":"msg-bot");
  msg.innerHTML = `<div>${text}</div><div class="meta">${sender==="user"?"You":"AI"} • ${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>`;
  log.appendChild(msg);
  log.scrollTop = log.scrollHeight;
  const history = JSON.parse(localStorage.getItem("chatHistory")||"[]");
  history.push({text, sender});
  localStorage.setItem("chatHistory", JSON.stringify(history));
}

function loadHistory() { 
  const h = JSON.parse(localStorage.getItem("chatHistory")||"[]"); 
  h.forEach(m=>renderMessage(m.text,m.sender));
}

function clearHistory(){ localStorage.removeItem("chatHistory"); document.getElementById("chat-log").innerHTML=""; }

function handleUserInput(text){
  renderMessage(text,"user");
  text=text.toLowerCase();
  let res="";

  if(text.includes("calories")){
    const f = Object.keys(FOOD_DB).find(k=>text.includes(k));
    if(f){ const d=FOOD_DB[f]; res=`${f} → ${d.calories} kcal, Protein: ${d.protein}, Carbs: ${d.carbs}, Fat: ${d.fat}`; }
    else res="Food not found.";
  }
  else if(text.includes("plan for")){ res="Meal plan generated 🍽️ Stay hydrated!"; }
  else if(text.includes("water")){ res="Drink ~35 ml water per kg 💧."; }
  else if(text.includes("bmi")){ res="BMI = weight(kg)/(height(m))². Normal: 18.5–24.9 ✅"; }
  else if(text.includes("motivate")){ res="You're doing amazing! Keep going 💪"; }
  else res="Try asking about calories, water, BMI, or meal plans.";

  setTimeout(()=>renderMessage(res,"bot"),300);
}

document.getElementById("send-btn").onclick = ()=>{ 
  const val=document.getElementById("user-input").value.trim(); 
  if(val){ handleUserInput(val); document.getElementById("user-input").value=""; } 
};
document.getElementById("user-input").addEventListener("keypress",e=>{ if(e.key==="Enter") document.getElementById("send-btn").click(); });
document.getElementById("clear-local").onclick=()=>{ if(confirm("Clear chat history?")) clearHistory(); };
document.getElementById("export-json").onclick=()=>{
  const data = localStorage.getItem("chatHistory")||"[]";
  const blob = new Blob([data],{type:"application/json"});
  const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="nutrition_chat.json"; a.click();
};
document.querySelectorAll(".chip[data-cmd]").forEach(c=>c.onclick=()=>{ 
  document.getElementById("user-input").value=c.dataset.cmd; 
  document.getElementById("send-btn").click(); 
});
document.getElementById("create-plan").onclick=()=>{ 
  document.getElementById("user-input").value="plan for "+document.getElementById("goal-select").value; 
  document.getElementById("send-btn").click(); 
};
document.getElementById("calc-water").onclick=()=>{ 
  const w=document.getElementById("user-weight").value; 
  document.getElementById("user-input").value="water for "+w+" kg"; 
  document.getElementById("send-btn").click(); 
};
loadHistory();
</script>
</body>
</html>
